<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.fudanPoem.mapper.ChatMessageMapper">

    <!-- 1. 实现selectChatHistory方法：查两个用户的聊天记录，按时间升序 -->
    <select id="selectChatHistory" resultType="org.example.fudanPoem.entity.ChatMessage">
        SELECT * FROM chat_message
        WHERE
        (sender_id = #{userId} AND receiver_id = #{otherId})
        OR
        (sender_id = #{otherId} AND receiver_id = #{userId})
        ORDER BY send_time ASC
    </select>

    <!-- 2. 实现updateUnreadToRead方法：批量更新未读消息为已读 -->
    <update id="updateUnreadToRead">
        UPDATE chat_message
        SET is_read = 1
        WHERE
        sender_id = #{senderId}
        AND receiver_id = #{receiverId}
        AND is_read = 0
    </update>

</mapper>